---
title: "Segunda entrega"
author: "Diego Da Rosa, Nahuel Bizoso, Valentina Soldini"
format: pdf
editor: visual
---

# INTRODUCCIÓN:

El mercado inmobiliario ha sido, durante muchos años de gran importancia tanto para inversores como para personas que buscan un alquiler. La variabilidad de los precios puede depender de diferentes factores como es la ubicación, caracteristicas de la propiedad, también la seguridad de la zona y algunos otros.Este proyecto se basa en analizar como estas variables afectan en los precios de las propiedades en los diferentes municipios.

Descripcion de los datos:

Los datos utilizados, incluyen inoformación sobre propiedades disponibles para ser alquiladas en todo el año 2023. Contiene múltiples variables como la dirección, el precio, caracteristícas fisicas de la prpiedad, tipo de propiedad, condiciones de la propiedad, y caracterizticas adicionales como terraza, vista al mar, garage. En un primer momento se va a realizar una analisis exploratorio de los datos para ver que relación tienen las diferentes variabes con respecto al precio.

Código reestructurado con los nombres de las variables en el español

```{r}
# Instalar librerías:

#install.packages("readr")
#install.packages("here")
#install.packages("cowplot")
#install.packages("gridExtra")



```

```{r}
# Importar librerías

library(readr)
library(readxl)
library(here)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(tibble)
library(cowplot)
library(gridExtra)

```

Datos

```{r}


# Datos sobre precio de casas
datos <- read_csv(here("houses.csv"))
datos


```

Tabla con las diferentes variables, tipo de variable y una descripcion

```{r}
# Creamos variables del tipo character
nombre_variable <- character()
tipo_variable <- character()
descripcion <- character()


# Creamos un dataframe donde vamos a almacenar la información de cada columna basandonos es: Nombre, Tipo de Dato, Descripción
tabla_variables <- data.frame(
  "Nombre de la variable" = nombre_variable,
  "Tipo de variable" = tipo_variable,
  "Descripción" = descripcion,
  stringsAsFactors = FALSE
)



# Creamos la tabla
tabla_variables[1,] <- c("direccion", "Numérica", "Ubicación donde se encuentra la propiedad")
tabla_variables[2,] <- c("nro_de_piso", "Character", "Número de piso de la propiedad")
tabla_variables[3,] <- c("tipo_prop", "Character", "Tipo de poropiedad, como apartamento, oficina, casa")
tabla_variables[4,] <- c("Condicion", "Character", "Condición en la que esta la vivienda, como Excelente, Buena, Renovada")
tabla_variables[5,] <- c("disposicion", "Character", "En que posición se encuentra la pripiedad como, interior, frente, fondo")
tabla_variables[6,] <- c("m2_terraza", "Numérica", "Metros cuadrado de la terraza")
tabla_variables[7,] <- c("cant_cuartos", "Numérica", "Cantidad de dormitoros de la propiedad")
tabla_variables[8,] <- c("vivienda_social", "Numérica", "Si la propiedad esta destinada para vivienda social es 1 y sino 0")
tabla_variables[9,] <- c("Closet", "Numérica", "Espacio de guardaropas en la propiedad")
tabla_variables[10,] <- c("Garage", "Numérica", "Garage en la propiedad")
tabla_variables[11,] <- c("Playroom", "Numérica", "Sala de juegos en la propiedad")
tabla_variables[12,] <- c("WiFi", "Numérica", "Conección a wifi en la propiedad")
tabla_variables[13,] <- c("balcon", "Numérica", "Balcon en la propiedad")
tabla_variables[14,] <- c("jardin", "Numérica", "Jardin en la propiedad ")
tabla_variables[15,] <- c("amueblado", "Numérica", "La propiedad viene con los muebles incluidos a la hora de ser alquilado")
tabla_variables[16,] <- c("Updated", "Fecha", "Última fecha que fue actualizado el listado")
tabla_variables[17,] <- c("Apartments_per_Floor", "Numérica", "Número de apartamentos por piso en el edificio")
tabla_variables[18,] <- c("zona", "Character", "En que zona de Montevideo se encuentra la propiedad")
tabla_variables[19,] <- c("baños", "Numérica", "Cuántos cuartos hay en la propiedad")
tabla_variables[20,] <- c("m2_totales", "Numérica", "Metros cuadrados de la propiedad")
tabla_variables[21,] <- c("cant_de_est", "Numérica", "Cantidad de estacionamientos que tiene disponible la propiedad")
tabla_variables[22,] <- c("Barbecue", "Numérica", "Barbacoa en la propiedad")
tabla_variables[23,] <- c("Patio", "Numérica", "Patio en la propiedad")
tabla_variables[24,] <- c("Pet", "Numérica", "Si se aceptan perros o no")
tabla_variables[25,] <- c("Duplex", "Numérica", "Si es un duplex o no, duplex es una propiedad que esta encima de otra y generalmente son dos")
tabla_variables[26,] <- c("zona_barbacoa", "Numérica", "Si hay una zona de barbacoa en el edificio de la propiedad")
tabla_variables[27,] <- c("deposito", "Numérica", "Área de almacenaiento o depósito en la propiedad")
tabla_variables[28,] <- c("losa_radiante", "Numérica", "Losa radiante en la propiedad")
tabla_variables[29,] <- c("precio_m2", "Numérica", "El precio de la propiedad por metros cuadrados")
tabla_variables[30,] <- c("Common_Expenses", "Numérica", "Gastos comunes asociados a la propiedad")
tabla_variables[31,] <- c("cant_de_piso", "Numérica", "Núemero total de piso en el edificio")
tabla_variables[32,] <- c("Condition", "Character", "En que condición se encuentra el apartamento")
tabla_variables[33,] <- c("cant_habitaciones", "Numérica", "Cantidad de habitaciones en la propiedad")
tabla_variables[34,] <- c("año_de_const", "Numérica", "En que año fue construida la propiedad")
tabla_variables[35,] <- c("vista_al_mar", "Numérica", "Propiedad con vista al mar o no")
tabla_variables[36,] <- c("Living_Room", "Numérica", "Propiedad con living o no")
tabla_variables[37,] <- c("Pool", "Numérica", "Pool en la propiedad")
tabla_variables[38,] <- c("coneccion_cas", "Numérica", "Propiedad cuenta con conección a gas directa o no")
tabla_variables[39,] <- c("calefaccion", "Numérica", "Propiedad con calefacción")
tabla_variables[40,] <- c("Gym", "Numérica", "Propiedad con gym")
tabla_variables[41,] <- c("Air_Conditioning", "Numérica", "Propiedad con aire acondicionado")
tabla_variables[42,] <- c("Solarium", "Numérica", "Propiedad con solarium")



# Resultado
tabla_variables
```

# Limpieza

1)  Renombrar columnas de ingles a español

2)  Poner columna de precio por metro cuadrado

3)  Eliminar columnas inecesarias

4)  Eliminar duplicados

5)  Eliminar y rellenar valores nulos

6)  Eliminar outliers

```{r}

#datos

# IDEA: Podríamos cambiar también los elementos de las columnas que esten en ingles a español con case_match
datos


# Renombrabos las columnas de ingles a español
datos <- datos|>
  rename(precio = Price,
         nro_de_piso = Floor,
         cant_de_piso = Number_of_Floors,
         Gastos_Comunes = Common_Expenses,
         apartamentos_por_piso = Apartments_per_Floor,
         zona = Zone,
         Condicion = Condition,
         disposicion = Disposition,
         cant_cuartos = Bedrooms...18,
         cant_habitaciones = Bedrooms...13,
         año_de_const = Year_of_Construction,
         vista_al_mar = Sea_View,
         deposito = Storage,
         jardin = Garden,
         losa_radiante = Radiant_Floor_Heating,
         amueblado = Furnished...45,
         direccion = Address,
         tipo_prop = Property_Type,
         baños = Bathrooms,
         m2_const = Built_Square_Meters,
         m2_totales = Land_Square_Meters,
         m2_terraza = Terrace_Square_Meters,
         vivienda_social = Social_Housing,
         cant_de_est = Garages,
         coneccion_cas = Gas_Pipeline,
         calefaccion = Heating,
         zona_barbacoa = Grill,
         balcon = Balcony
         )


datos

```

2)  Poner columna de precio por metro cuadrado

```{r}
# Pasar el precio a precio por metro cuadrado
datos <- datos|>
  mutate(precio_m2 = precio/m2_const)

datos

```

3)  Eliminar columnas inecesarias

```{r}
# Eliminamos columnas innecesarias
 datos <- 
   datos|>
    select(-Furnished...32, -Furnished...42, -Floors)#

datos
 

```

4)  Eliminar duplicados

```{r}

# Contamos la cantidad de duplicados en el DataFrame
sum(duplicated(datos))


# Eliminamos los duplicados
datos <- datos[!duplicated(datos), ]
datos

# IMPORTANTE: Casi la mitad del dataframe estaba duplicada, paso de tener 2361 filas a tener 1078 !!



```

5)  Eliminar o rellenar valores nulos

```{r}

# Función para detectar las columnas que tienen nulos

detector_nulos <- function(datos){ # Función
  data_nulos <- data.frame(cantidad_nulos = sapply(datos, function(x) sum(is.na(x)))) 
  # Aplicamos la función sapply par ver sumar la cantidad total de nulos en las los datos y a este objeto lo guardamos como un dataframe
  
  resultado <- data_nulos %>% filter(cantidad_nulos > 0)
  return(resultado)
  # De este DataFrame filtramos solo las columnas que tengan una cantidad total de valores nulos mayor a 0
}

detector_nulos(datos)



# Hay cuatro columnas que tienen valores nulos
# Que son Address, Condition, Disposition, Floors



# Las columnas con valores nulos son:
# direccion (209)   categorica
# Condicion (18)    categorica
# disposicion (13)  categorica
# precio_m2 (1)     númerica

# Vamos a usar el método de inputar los valores nulos con sus valores más comunes en el caso de variables categoricas y con su media en el caso de variables númericas.






```

```{r}


datos
# Seleccionar el elemento que más se repite, para esto hacemos un table de la columna en el dataframe, ordenamos esa tabla de mayor a menor y seleccionamos el primer elemento en formato texto
nombre_1 <- names(sort(table(datos$Condicion), decreasing = TRUE)[1])

nombre_2 <- names(sort(table(datos$disposicion), decreasing = TRUE)[1])


```

```{r}
# Reemplazamos los NaN de la columna Condicion con nombre_1 y los NaN de la columna disposicion con nombre_2
datos$Condicion[datos$Condicion %in% NA] <- nombre_1
datos$disposicion[datos$disposicion %in% NA] <- nombre_2


```

```{r}


# Revisamos de nuevo la cantidad de nulos
# data_nulos <- data.frame(cantidad_nulos = sapply(datos, function(x) sum(is.na(x))))
# # Aplicamos la función sapply par ver sumar la cantidad total de nulos en las los datos y a este objeto lo guardamos como un dataframe
# 
# data_nulos %>% filter(cantidad_nulos > 0)


detector_nulos(datos)

```

```{r}

# Filtrar los valores de Inf en la columnad de precio_m2
mean_filtrada <- datos %>%  # Datos
  filter(is.finite(precio_m2)) %>% # Obtenemos solo los datos finitos (que no sean infinito)
  summarise(media = mean(precio_m2)) %>% # Resumimos con la media
  pull(media) # Obtenemos la media como un número
mean_filtrada
  

# Reemplazamos los valores de Inf con la media
datos$precio_m2[datos$precio_m2 %in% "Inf"] <- mean_filtrada




```

```{r}

# Reescribimos
datos <- datos[!is.na(datos$precio_m2), ]
datos



detector_nulos(datos)


```

```{r}
# Para tratar los datos nulos en la columna de direccion vamos a reemplazarlos con datos de zona asociados

datos <- datos %>% # Datos
  mutate(direccion = if_else(is.na(direccion), zona, direccion)) 
# La columna dirección va a reemplazar a su valor nulo que esta en una fila X por el valor que esta en la columna de zona en esa misma fila X




detector_nulos(datos)


```

```{r}

```

6)  Detectar y eliminar valores nulos:

```{r}
# Criterio de rango intercuartilico
# Es un criterio que se usa para detectar Outliers

# El criterio de rango intercuartilico dice que si un valor esta por
# debajo del limite inferior (que es el quantil Q1 -1,5 * IQR) o por
# encima del limite superior (que es el quantil Q3 + 1,5 * IQR)





# Función para el criterio de outliers
detectar_outliers_iqr <- function(x) { # Función
  Q1 <- quantile(x, 0.25)              # Primer Quantil
  Q3 <- quantile(x, 0.75)              # Tercer Quantil
  IQR <- Q3 - Q1                       # Rango Intercuartilico
  lower_bound <- Q1 - 1.5 * IQR        # Límite Inferior
  upper_bound <- Q3 + 1.5 * IQR        # Límite Superior
  
  outliers <- x[x < lower_bound | x > upper_bound] 
  # Si el valor esta por debajo del limite inferior o por encima del límite superior, entonces es un outlier
  
  return(outliers) # Retorno
}


# Pruebas
detectar_outliers_iqr(datos$Price)
detectar_outliers_iqr(datos$Common_Expenses)
detectar_outliers_iqr(datos$Air_Conditioning)
detectar_outliers_iqr(datos$Solarium)
detectar_outliers_iqr(datos$Pool)


```

Agrupar los barrios por municipios

```{r}

datos <- datos %>% # Datos
  mutate(Municipio = case_when( # Casos donde a cada barrio le vamos a asociar un municipio
    
    zona %in% c("Cerro","La Teja","Paso de la Arena","Belvedere","Nuevo París","Prado")  ~ "Municipio_A",

    zona %in% c("Cordón","Parque Rodó","Palermo","Barrio Sur","Ciudad Vieja","Centro","Aguada","La Comercial") ~ "Municipio_B",

    zona %in% c("Aguada", "Arroyo Seco", "Atahualpa", "Bella Vista", "Brazo Oriental", "Capurro", "Goes", "Jacinto Vera", "La Comercial", "Mercado Modelo", "Reducto", "Villa Muñoz") ~ "Municipio_C",

    zona %in% c("Tres Cruces", "La Blanqueada", "Parque Batlle", "Villa Dolores", "Buceo", "Pocitos", "Punta Carretas") ~ "Municipio_CH",

    zona %in% c("Piedras Blancas", "Villa Española", "Unión","Bolivar","Cerrito") ~ "Municipio_D",

    zona %in% c("Malvín Norte","Malvín", "Carrasco Norte", "Carrasco", "Punta Gorda", "Buceo", "La Blanqueada") ~ "Municipio_E",

    zona %in% c("Maroñas", "Flor de Maroñas", "Villa Española", "Ituzaingó", "Jardines del Hipódromo", "Piedras Blancas") ~ "Municipio_F",

    zona %in% c("Lezica", "Peñarol", "Nuevo París", "Sayago", "Conciliación", "Colón") ~ "Municipio_G",

    TRUE ~ "Otro" # Por si hay barrios que no estén en la lista
  ))



datos
```

```{r}

# Vamos a eliminar los valores atípicos que estan en el dataframe
datos <- datos %>% filter(precio <= 150000 & Gastos_Comunes <= 10000)



datos

```

# Visualización

```{r}


# Pregunta 1) ¿Cambia el precio con respecto al barrio en que se ecuestre la propiedad?


# Elegimos los colores manualmente
colores_personalizados <- c(
  "Municipio_A" = "red",  "Municipio_B" = "blue",  "Municipio_C" = "green",                   "Municipio_CH" = "purple",  "Municipio_D" = "orange",   "Municipio_E" = "pink",
  "Municipio_F" = "brown",  "Municipio_G" = "cyan")





# Gráfico
ggplot(datos, aes(x = zona, y = precio, fill = Municipio)) +  # Datos, ejes y color
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  # Ancho y posición de las barras

  facet_grid(. ~ Municipio, scales = "free_x") +
  # Usar facet_grid para crear una grilla por Municipio

  labs(x = "Zona", y = "Precio", fill = "Municipio") + # Etiquetas de los ejes y la leyenda
  ggtitle("Precio por Zona y Municipio") + # Título
  scale_fill_manual(values = colores_personalizados) + # Cambiar la paleta de colores

  theme(plot.title = element_text(hjust = 0.5), # Centrar el título
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
# Centrar el título y modificar el texto de los elementos del eje X




```

Vemos que si, los barrios ubicados en el municipio A y E son los que tienen un precio más +6elevado, mientras que los barrios ubicados en los municipios D y G son los más baratos.

```{r}
# P2) ¿En que municipio hay más alquileres?

# Cantidad de alquileres por municipio
grupo_municipio <- datos %>%  # Datos
  group_by(Municipio) %>%       # Agrupamos por municipio
  summarise(Cantidad = n())     # Resumimos con la cantidad
grupo_municipio


# Gráfico
ggplot(grupo_municipio, aes(x=fct_reorder(Municipio, Cantidad), y=Cantidad)) + # Datos y ejes
  geom_bar(stat="identity") + # Gráfico de barras
  labs(x="Municipio", y="Precio") + # Nombres de los ejes
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1, size=8))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X

```

Vemos que la mayoría de alquileres se dan en el municipio CH y la minoría de alquileres se dan en el Municipio F

```{r}
# Pregunta 3) Qué tipo de inmuebles para alquilar hay?


grupo_tipo <- datos %>% # Datos
  group_by(tipo_prop) %>% # Agrupar por tipo de propiedad
  summarise(Cantidad = n()) # Resumir por cantidad 
grupo_tipo


# Gráfico
ggplot(grupo_tipo, aes(x=fct_reorder(tipo_prop, Cantidad), y=Cantidad)) + # Datos y ejes
  geom_bar(stat="identity") + # Gráfico de barras
  labs(x="Municipio", y="Precio") + # Nombres de los ejes
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1, size=8))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X




```

La mayoría de alquileres son de Apartamentos, muy pocos son de Tierra, de Negocios Especiales, de Edificios o de Garages.

```{r}

# P4) ¿Cómo se distribuyen los tipos de inmuebles por municipio?



# Gráfico
ggplot(datos, aes(x = tipo_prop, y = precio, fill = Municipio)) + # Datos, ejes y color
  geom_bar(stat = "identity", position = "dodge", width = 0.7) + # Ajustar el ancho de las barras
  facet_grid(. ~ Municipio, scales = "free_x") + # Usar facet_grid para crear una grilla por Municipio
  labs(x = "Zona", y = "Precio", fill = "Municipio") + # Etiquetas de los ejes y la leyenda
  ggtitle("Tipo de alquiler por municipio") + # Título del gráfico
  scale_fill_manual(values = colores_personalizados) + # Cambiar la paleta de colores
  theme(plot.title = element_text(hjust = 0.5), # Centrar el título
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X





# subpregunta: hacer una intersección de tipo de alquileres con estado de alquiler
# tipo los garages estan en construcción, las casas que estan en buen estado y así


```

```{r}
datos

# P5) ¿En qué condición se encuentran los alquileres? (Subpregunta de esta: subdividiendo por tipo de alquiler)

datos


grupo_estado <- datos %>% # Datos
  group_by(Condicion) %>% # Agrupar por condición de la vivienda
  summarise(Cantidad = n()) # Resumir por la cantidad
grupo_estado


# Gráfico
ggplot(grupo_estado, aes(x=fct_reorder(Condicion, Cantidad), y=Cantidad)) + # Datos y ejes
  geom_bar(stat="identity") + # Gráfico de barras
  labs(x="Municipio", y="Precio") + # Nombre de los ejes
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1, size=8))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X


# subpregunta: hacer una intersección de tipo de alquileres con estado de alquiler
# tipo los garages estan en construcción, las casas que estan en buen estado y así 

```

La mayoría de los inmuebles estan en buena condición o excelente condición. Pocos de ellos estan en construcción, o con necesidad de mantenimiento o por ser renovados.

```{r}


# P6) ¿Como se distribuyen las condiciones de las viviendas por municipio?

# Gráfico
ggplot(datos, aes(x = Condicion, y = precio, fill = Municipio)) + # Datos, ejes y color
  geom_bar(stat = "identity", position = "dodge", width = 0.7) + # Ajustar el ancho de las barras
  facet_grid(. ~ Municipio, scales = "free_x") + # Usar facet_grid para crear una grilla por Municipio
  labs(x = "Zona", y = "Precio", fill = "Municipio") + # Etiquetas de los ejes y la leyenda
  ggtitle("Condición de la vivienda por Municipio") + # Título del gráfico
  scale_fill_manual(values = colores_personalizados) + # Cambiar la paleta de colores
  theme(plot.title = element_text(hjust = 0.5), # Centrar el título
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X



```

```{r}


# A ver los gastos comunes se pueden relacionar
# con: Municipio, Estado de la vivienda, Tipo de vivienda,


# P7) ¿Como se distribuyen los gastos comúnes por Municipio?
ggplot(datos, aes(x = Municipio , y = Gastos_Comunes)) +  # Datos y ejes
  geom_bar(stat="identity") + # Gráfico de barras
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X


```

```{r}
# P8) ¿Cómo influye el tipo de alquiler en el nivel de gastos comunes?

ggplot(datos, aes(x = tipo_prop, y = Gastos_Comunes)) +  # Datos y ejes
  geom_bar(stat="identity") + # Gráfico de barras
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X




# subdiviridr por municipio? Que gastos son más comunes según el tipo de alquiler por municipio

```

```{r}


# P9) ¿Cómo influye la condición de el alquiler en el nivel de gastos comunes?


ggplot(datos, aes(x = Condicion , y = Gastos_Comunes)) +  # Datos y ejes
  geom_bar(stat="identity") + # Gráfico de barras
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X


```

```{r}

# P10) ¿Cómo se distribuyen los Gastos Comunes en relación al tipo de alquiler por Municipio?

datos


ggplot(datos, aes(x = tipo_prop, y = Gastos_Comunes, fill = Municipio)) + # Datos, ejes y municipio
  geom_bar(stat = "identity", position = "dodge", width = 0.7) + # Ajustar el ancho de las barras
  facet_grid(. ~ Municipio, scales = "free_x") + # Usar facet_grid para crear una grilla por Municipio
  labs(x = "Zona", y = "Precio", fill = "Municipio") + # Etiquetas de los ejes y la leyenda
  ggtitle("Condición de la vivienda por Municipio") + # Título del gráfico
  scale_fill_manual(values = colores_personalizados) + # Cambiar la paleta de colores
  theme(plot.title = element_text(hjust = 0.5), # Centrar el título
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X


#

```

```{r}

# P11) ¿Cómo se distribuyen los Gastos Comunes en relación a la condición del alquiler por Municipio?


ggplot(datos, aes(x = Condicion, y = Gastos_Comunes, fill = Municipio)) + # Datos, ejes y color
  geom_bar(stat = "identity", position = "dodge", width = 0.7) + # Ajustar el ancho de las barras
  facet_grid(. ~ Municipio, scales = "free_x") + # Usar facet_grid para crear una grilla por Municipio
  labs(x = "Zona", y = "Precio", fill = "Municipio") + # Etiquetas de los ejes y la leyenda
  ggtitle("Condición de la vivienda por Municipio") + # Título del gráfico
  scale_fill_manual(values = colores_personalizados) + # Cambiar la paleta de colores
  theme(plot.title = element_text(hjust = 0.5), # Centrar el título
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
# Cambiar el ángulo y el tamaño del texto de los elementos del eje X


```

```{r}

# P12) Cómo influye l tener o no ciertas caracteristicas en el alquiler (como son wifi, una barbacoa o un jardin) en el precio con respecto a los alquileres que no lo tienen?

# quitar variables: Furnished...32, Furnished...42, y Flors




# # Obtenemos las columnas que tienen valores entre 0 y 1

dum <- datos %>%
select("vista_al_mar","vivienda_social","Barbecue","Living_Room","Closet","Patio","Pool","Garage","Pet","coneccion_cas","Playroom","Duplex","calefaccion","WiFi","zona_barbacoa","Gym","balcon","deposito","Air_Conditioning","jardin","losa_radiante","Solarium","amueblado")




# Función para crear el dataframe que tiene 0 y 1 en sus filas, las variables en sus columnas y el promedio de precio en cada celda.

calcular_y_unir <- function(df, col, resultado_final) { # Función
  temp <- df %>%       # Datos
    group_by(valor = .data[[col]]) %>% # Agrupamos por todas las columnas
    summarise(Mean = mean(precio, na.rm = TRUE), .groups = "drop")
  # Resumimos con la media, ignorando los nulos

  colnames(temp)[2] <- paste0(col, "_Media") # A cada columna del dataframe resultante le vamos a pegar la palabra "_Mean"
  resultado_final <- left_join(resultado_final, temp, by = "valor", relationship = "many-to-one") # Hacemos un join con todos los resultados, teniendo la columna "valor" como columna común entre las tablas para unirlas
  return(resultado_final) # Resultado
}



# DataFrame inicial
resultado_final <- data.frame(valor = c(0, 1))


# Obtenemos las columnas del dataframe dum
columnas <- colnames(dum)



# Aplicar la función creada a cada columna
for (col in columnas) { # Para cada columna
  resultado_final <- calcular_y_unir(datos, col, resultado_final)
} # Aplicamos la función


# DataFrame resultante
resultado_final




```

```{r}


# Función para gráficar 
funcion_dum <- function(datos){

# Pasamos los datos al formato largo con pivot_longer
  data_long <- datos %>%
    pivot_longer(-valor, names_to = "variable", values_to = "value")

  # Gráfico
  ggplot(data_long, aes(x = variable, y = value, fill = as.factor(valor))) + # Datos, ejes y color
    geom_bar(stat = "identity", position = position_dodge(width = 0.5)) +  # Gráfico de barras, con barras superpuestas
    labs(x = "Variable", y = "Value", fill = "Value") + # Nombre de los ejes
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
#Cambiar ángulo y tamaño del texto de los elementos del eje X
  
}


# Resultados
funcion_dum(resultado_final)
```

```{r}

# Floors (Piso)    Español: nro_de_piso

# Number_of_Floors (Número de pisos en todo el edificio)
# Español: cant_de_piso


# Apartments_per_Floor (Cantidad de apartamentos en ese piso)   Español: apartamentos_por_piso


```

```{r}
# P13) ¿Cómo cambia el precio según la cantidad de pisos que tiene el inmueble?

grupo_piso_1 <- datos %>% # Datos
  group_by(cant_de_piso) %>% # Agrupados por cantidad de pisos
  summarise(Cantidad = n()) # Resumidos por cantidad
grupo_piso_1



# Filtrar atipicos
grupo_piso_1 <-grupo_piso_1 %>% filter(cant_de_piso < 16)



# Gráfico
ggplot(grupo_piso_1, aes(x = cant_de_piso, y=Cantidad)) +  # Datos y ejes
   geom_bar(stat="identity") + # Gráfico de barras
    scale_x_continuous(breaks =   grupo_piso_1$cant_de_piso) #  Elementos del eje X






```

```{r}


# P14) ¿Cómo influye el piso en el precio? Los pisos más altos o más bajos influyen en el precio?


Prueba11 <- datos %>% # Datos
   group_by(nro_de_piso) %>% #Agrupados por número de piso
   summarise(media_precio = mean(precio)) # Resumidos por media con respecto al precio
Prueba11



# Filtrar nulos
Prueba12 <- Prueba11 %>% filter(nro_de_piso < 43)


# Gráfico
ggplot(Prueba12, aes(x=nro_de_piso, y=media_precio)) + # Datos y ejes
      geom_bar(stat="identity") + # Gráfico de barras
      scale_x_continuous(breaks =  Prueba12$nro_de_piso) # Elementos del eje X Escala del eje X



# Parece que en los pisos mas altos el precio es
```

```{r}
# P15) ¿Cómo influye la cantidad de apartamentos por piso en el precio?


grupo_piso_1 <- datos %>%   # Datos
  group_by(apartamentos_por_piso) %>% # Agrupados por pisos por apartamentos
  summarise(Cantidad = n()) # Resumido por cantidad
grupo_piso_1


# Filtrar nulos
grupo_piso_1 <- grupo_piso_1 %>% filter(apartamentos_por_piso < 11)


# Gráfico
ggplot(grupo_piso_1, aes(x = apartamentos_por_piso, y=Cantidad)) +  # Datos y ejes
   geom_bar(stat="identity") + # Gráfico de barras
   scale_x_continuous(breaks =  grupo_piso_1$apartamentos_por_piso)
# Elementos del eje X


```

```{r}
# P2) Number_of_Floors
# Cuántos más pisos tiene el inmueble (edificio), más caro es?
#






 # Vemos que los apartamentos que tienen pocos pisos (exactamente 2) son los más caros
# Aunque también algunos apartamentos con más pisos, aproximadamente 24 pisos, tiene un precio elevado

```

```{r}

# PRECIO SEGÚN BAÑOS

# P16) ¿Cómo influye la cantidad de baños en el precio?
Prueba13 <- datos %>%  # Datos
   group_by(baños) %>% # Agrupado por baños
   summarise(media_precio = mean(precio)) # Resumido por la media del precio
Prueba13


# Gráfico de conteo por cantidad de baños
ggplot(datos, aes(x=baños)) + # Datos y eje
        geom_bar() +          # Gráfico de barras
        scale_x_continuous(breaks =  Prueba13$baños) # Elementos del eje X


# Gráfico de precio en relación a la cantidad de baños 
ggplot(Prueba13, aes(x=baños, y=media_precio)) + # Datos
   geom_bar(stat="identity") +  # Gráfico de barras
   scale_x_continuous(breaks =  Prueba13$baños) # Elementos del eje X

```

# Baños

```{r}
#colnames(datos)
# PRECIO SEGÚN CANTIDAD DE CUARTOS Y CANTIDAD DE HABITACIONES



# cant_habitaciones = Bedrooms...13,
# cant_cuartos = Bedrooms...18,



# P17) ¿Cómo influye la cantidad de habitaciones en el precio?
Prueba15 <- datos %>%      # Datos
   group_by(cant_habitaciones) %>% #Agrupados por cantidad de habitaciones
   summarise(media_precio = mean(precio)) # Resumido por la media del precio
Prueba15





# Gráfico de conteo por cantidad de habitaciones
ggplot(datos, aes(x=cant_habitaciones)) + # Datos y ejes
 geom_bar() +  # Gráfico de barras
 scale_x_continuous(breaks =  Prueba15$cant_habitaciones) # Elementos del eje X



# Gráfico de precio en relación a la cantidad de habitaciones 
ggplot(Prueba15, aes(x=cant_habitaciones, y=media_precio)) +  # Datos y ejes
 geom_bar(stat="identity") +  # Gráfico de barras
 scale_x_continuous(breaks =  Prueba15$cant_habitaciones) # Elementos del eje X






# P18) ¿Cómo influye la cantidad de cuartos en el precio?
Prueba25 <- datos %>%  # Datos 
   group_by(cant_cuartos) %>% # Agrupado por cantidad de cuartos
   summarise(media_precio = mean(precio)) # Resumido por la media del precio
Prueba25


# Gráfico de conteo por cantidad de cuartos
ggplot(datos, aes(x=cant_cuartos)) + # Datos
 geom_bar() +   # Gráfico de barras
 scale_x_continuous(breaks =  Prueba25$cant_cuartos) # Elementos del eje X



# Gráfico de precio en relación a la cantidad de cuartos 
ggplot(Prueba25, aes(x=cant_cuartos, y=media_precio)) +  # Datos
  geom_bar(stat="identity") +   # Gráfico de barras
  scale_x_continuous(breaks =  Prueba25$cant_cuartos) # Elementos del eje X





```

```{r}

# PRECIO SEGÚN CANTIDAD DE GARAGES 

# P19) ¿Cómo influye la cantidad de garages en el precio?
Prueba16 <- datos %>%         # Datos
   group_by(cant_de_est) %>%  # Agrupado por cantidad de garages
   summarise(media_precio = mean(precio)) # Resumido por media del precio
Prueba16



# Gráfico de conteo por cantidad de garages
ggplot(datos, aes(x=cant_de_est)) + # Datos y ejes
     geom_bar() +  # Gráfico de barras
     scale_x_continuous(breaks =  Prueba16$cant_de_est) # Elementos del eje X



# Gráfico de precio en relación a la cantidad de garages 
ggplot(Prueba16, aes(x=cant_de_est, y=media_precio)) +  # Datos y ejes
   geom_bar(stat="identity") +   # Gráfico de barras
   scale_x_continuous(breaks =  Prueba16$cant_de_est) # Elementos del eje X






```

```{r}
# Built_Square_Meters
# Terrace_Square_Met
# Land_Square_Metersers
```

```{r}

# PRECIO SEGÚN METROS CUADRADOS EN DISTINTOS ELEMENTOS

# Filtramos para eliminar los nulos
datos <- datos %>% filter( (m2_const < 3000 & m2_const > 0) & (m2_totales < 5000 & m2_const > 0) & (m2_terraza > 0) & (precio < 30000) )



# m2_const = Built_Square_Meters,
# m2_totales = Land_Square_Meters,
# m2_terraza = Terrace_Square_Meters,





# METROS CUADRADOS POR CONSTRUCCIÓN
# P20) ¿Cómo influyen los metros cuadrados por construcción en el precio?
ggplot(datos, aes(x=m2_const, y=precio)) +  # Datos y ejes
  geom_point()  # Gráfico de barras
 

# METROS POR TERRAZA
# P21) ¿Cómo influyen los metros cuadrados por terraza en el precio?
ggplot(datos, aes(x=m2_terraza, y=precio)) +   # Datos y ejes   
  geom_point()  # Gráfico de barras


# METROS CUADRADOS POR TIERRA
# P22) ¿Cómo influyen los metros cuadrados por tierra en el precio?
ggplot(datos, aes(x=m2_totales, y=precio)) +   # Datos y ejes
  geom_point()  # Gráfico de barras

#
```

```{r}

# Built_Square_Meters
# Terrace_Square_Met
# Land_Square_Metersers
max(datos$m2_const)
max(datos$m2_terraza)
max(datos$m2_totales)


```


No parece haber una relación clara sobre la relación entre metros cuadrados y precio, no se cumple lo que uno puede intuitivamente pensar que es que el precio va a ser mayor conforme sean mayores los metros cuadrados.

```{r}
# Quitar los 0 metros cuadrados, es algo que no tiene mucho sentido. (hecho)

# Exportar los datos limpios

library(writexl)
#()
write_xlsx(datos, path = here("Shiny_Proyecto","app","datos_limpios.xlsx"))
```

# Modelo de regresión lineal multiple:

```{r}
datos
names(datos)

library(tidyverse)
library(GGally)
library(car)
library(skedastic)
library(robustbase)
library(tseries)


```

```{r}
# Función para reemplazar valores NA en 'direccion' con los valores de 'zona'
reemplazar_direccion <- function(datos) {
  if (!"direccion" %in% colnames(datos) || !"zona" %in% colnames(datos)) {
    stop("Las columnas 'direccion' y 'zona' deben estar presentes en los datos.")
  }
  datos$direccion <- ifelse(is.na(datos$direccion), datos$zona, datos$direccion)
  return(datos)
}

datos <- reemplazar_direccion(datos)

datos <- datos|>
  mutate(precio_m2 = precio/m2_const)


# Función para rellenar valores NA en 'precio_m2' con la media de los valores existentes
rellenar_na_precio_m2 <- function(datos) {
  # Verificar si la columna 'precio_m2' existe
  if (!"precio_m2" %in% colnames(datos)) {
    stop("La columna 'precio_m2' no está presente en los datos.")
  }
media_precio_m2 <- mean(datos$precio_m2, na.rm = TRUE)
  
  # Rellenar los valores NA con la media calculada
  datos$precio_m2[is.na(datos$precio_m2)] <- media_precio_m2
  
  return(datos)
}

datos <- rellenar_na_precio_m2(datos)

# Función para reemplazar valores NA en 'Condicion' con 'Good condition'
reemplazar_na_condicion <- function(datos) {
  if (!"Condicion" %in% colnames(datos)) {
    stop("La columna 'Condicion' no está presente en los datos.")
  }
  
  datos$Condicion[is.na(datos$Condicion)] <- "Good condition"
  
  return(datos)
}

datos <- reemplazar_na_condicion(datos)

# Función para reemplazar valores NA en 'disposicion' con 'Front'
reemplazar_na_disposicion <- function(datos) {
  if (!"disposicion" %in% colnames(datos)) {
    stop("La columna 'disposicion' no está presente en los datos.")
  }
  
  datos$disposicion[is.na(datos$disposicion)] <- "Front"
  
  return(datos)
}

datos <- reemplazar_na_disposicion(datos)

print(colSums(is.na(datos)))
```

```{r}

# Eliminamos columnas innecesarias
 datos <- 
   datos|>
   select(-Furnished...32, -Furnished...42, -Floors, -precio, -zona)

names(datos)
modelo <- lm(precio_m2 ~ ., data = datos)
vif(modelo)
summary(modelo)
names(datos)


vif_values <- vif(modelo)

# Mostrar los valores de VIF
print(vif_values)
```

valores nulos

```{r}

datos_nulos <- data.frame(cantidad_2_nulos = sapply(datos, function(x) sum(is.na(x))))
# Aplicamos la función sapply par ver sumar la cantidad total de nulos en las los datos y a este objeto lo guardamos como un dataframe

data_2_nulos %>% filter(cantidad_2_nulos > 0)

datos <- datos[!duplicated(datos), ]
datos

table(datos$Condicion)
table(datos$disposicion)




```

```{r}
colnames(datos)
datos

```

```{r}




```

```{r}
colnames(datos)


```

```{r}



```

```{r}



```

```{r}



```

```{r}



```
